# FlowViz 要件定義 v1.0（確定版）

**作成日:** 2025-10-05  
**対象:** スタンドアロン依存関係可視化アプリ（FlowViz）  
**想定読者:** プロダクトオーナー、設計者、実装担当、配布運用担当

---

## 1. 目的 / ゴール
- MermaidライクなMarkdown（`graph` / `flowchart`）を読み込み、システム/データパイプラインの依存関係を**ローカル環境のみ**で高速可視化。
- ノード選択により**下流方向の影響範囲を即時ハイライト**し、影響分析を省力化。
- **Windows 11 exe配布**、**追加インストール不要**を実現。

## 2. スコープ
- 可視化ビューア（D3.js v7）
- FlowMD（Mermaidサブセット）読込
- ノード選択→下流ハイライト
- 検索・CSV出力・スクリーンショット・ズーム/パン
- v1非対象：双方向編集・永続DB・共有機能など

## 3. 想定ユースケース
1. 障害発生時：ノード選択→下流ハイライト→CSV出力
2. 設計変更レビュー：影響範囲の可視化
3. 新FlowMDレビュー：構造全体俯瞰・確認

## 4. 前提 / 制約
- OA環境で **WebView2導入不可**  
- オフライン前提（CDN禁止）  
- **JavaScript（Vanilla）＋Python 3.13**  
- **npm不使用**  
- ノード≦1000（推奨300）

## 5. 実行形態（既定ブラウザプロファイル）
- Pythonランチャーが `http.server` を起動 → 既定ブラウザで `viewer.html` 表示
- PyInstallerでexe化、追加ランタイム不要

## 6. アーキテクチャ方針
- `FlowViz.exe` → Pythonランチャー（静的配信・CSP付与）
- `viewer` → HTML+JS+D3.js
- データ流れ：FlowMD → Parser → GraphModel → Renderer
- 外部通信なし・CSPで封鎖

## 7. 入出力仕様
- 入力：`graph|flowchart` 構文（`subgraph`でレーン表現）
- 出力：CSV（下流ノード一覧）・PNG（描画キャプチャ）

## 8. 機能要件
### 8.1 MVP
- FlowMD読込、描画、ハイライト、検索、CSV/PNG出力
### 8.2 単体テスト要件
- 対象：パーサ、ハイライト、検索、出力、ユーティリティ  
- runner: `/app/assets/test/runner.html`  
- ケース: `/app/assets/test/testcases/*.json`  
- 実行: `FlowViz.exe --selftest` → `logs/test-report.json`
- 合格基準：必須ケース100%

## 9. 非機能要件
- 描画≤2.0s / 300ノード  
- BFSハイライト≤50ms  
- 完全オフライン／外部通信禁止  
- 単一exe配布／CSP厳格

## 10. UI/UX
- ツールバー（読込/検索/出力/リセット）
- キャンバス操作：ホイール=ズーム、ドラッグ=パン
- 強調／フェード表示・ツールチップ補足

## 11. エラー処理
- 構文エラー行番号表示
- 循環依存検出
- メモリ不足時の縮退描画

## 12. ログ
- 起動・ファイル名・処理時間を `logs/app.log` に追記  
- 機微情報は出力禁止

## 13. 配布構成
（→ `AGENTS.MD`に統合された詳細版を参照）

## 14. 受入基準
- `demo-large.md` の描画・ハイライト・出力成功
- 追加インストール不要
- オフライン動作・外部通信なし

## 15. 方針決定
- Mermaid: `graph` / `flowchart` 両対応（正規化処理）  
- レイアウト: `forceSimulation`  
- PNG出力: `svg→canvas` 変換  
- 1000ノード超は縮退モード

---
